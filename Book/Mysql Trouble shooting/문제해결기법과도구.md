## 6.5.5 Show [Global] Status

* 상태변수는 전역변수와 세션변수로 나뉜다. 
	* 클라이언트가 연결 될 때 세션변수는 0으로 설정되고, 전역변수는 서버가 시작한 후 가장 최근에 Flush Status 명령을 실행한 이후의 상태를 보여준다.

* 상태변수로 문제를 해결할 때는 변수 값을 한 번만 확인하지 않아야 한다. -> 시간이 지나면서 바뀌는 추이를 보아야한다. 값이 크고 빠르게 증가하고 있다면 어떤 문제가 있음을 암시한다.

* 상태변수의 종류
	* Com_* 변수
		* 종류별로 명령이 내려진 쿼리의 개수를 가지고 있다. Com_select는 select 명령의 실행 횟수를 알 수 있다. 이 변수는 서버에 어떤 부하가 걸리는지 간략히 보여준다. 예를 들어 Com_insert의 값이 크다면 거기에 맞춰 설정을 조정해야 한다.
	* Handler_*,Select_*,Sort_* 변수
		* Handler_*: 쿼리가 실행될 때 테이블 내부에 어떤일이 일어나는지 알려준다. Handler_delete변수는 삭제된 행의 개수를 알려준다. 사이즈가 큰 테이블의 DELETE 진행 상태를 파악할 수 있다.
		* Select_*: 조인 방법별로 사용된 횟수를 알 수 있다.
		* Sort_*: 정렬에 대한 변수 정보를 알 수 있다.
	* Innodb_* 변수
		* Innodb 스토리지 엔진의 내부 상태를 알려준다. 다양한 연구가 필요함
	* Performance_schema_* 변수
		* 서버나 스토리지 엔진의 소스코드에서 측정위치가 정의된 객체에 대한 정보를 알려준다. 
	* SSL_* 변수
		* SSL 연결에 대한 정보
	* *open*, *close* 변수
		* 종류별로 사용하거나 생성한 객체들의 개수를 알 수 있다.
		
# 6.7 문제를 해결하는 일반적인 단계

* 문제를 일으키는 실제 쿼리를 찾아낸다
* 쿼리 문법을 확인한다.
* 쿼리에 문제가 있는지 확인한다.
* 쿼리가 예상과 다른 데이터를 반환한다면 올바를 결과를 반환하도록 수정한다.
* 쿼리를 수정해도 원인을 찾지 못한다면 서버옵션을 검사하고, 서버 옵션이 결과에 영향을 주는지 알아본다. 이 때 쿼리를 단순화한 후 설정을 변경하는 것이 좋다.
* 쿼리에 문제가 없다고 확인되면 쿼리가 처리하는 데이터를 처리하거나 손상시킨 문장이나 작업으로 거슬러 올라간다.
* Mysql CLI에서 문제가 재현되지 않으면 동시성 문제를 조사한다.
* 크래시되거나 멈추는 현상이 발생하면 에러로그 파일을 먼저 검사한다.
* 에러로그 파일에서 아무런 단서를 찾을 수 없다면 크래시 직전에 수행한 쿼리를 찾는다.
* 장애가 발생하는 서버에 mysql-debug를 실행해 생성된 코어 덤프파일을 분석한다.
* 설정 옵션을 분석하고 조정한다.
* mysql에 영향을 줄 수 있는 외부 프로세스를 찾아내기 위해 운영체제 도구를 사용한다.

# 6.8 테스트 방법

테스트 케이스를 최소화 하면 문제의 원인을 찾고 해결할 수 있다.
* 새로운 버전에 쿼리 시도하기: 해당 버그가 새 버전에서 수정이 될 수 있기 때문에 새 버전에서도 시도를 해보는 것이 좋다.
* 알려진 버그 확인하기: 알려진 버그로 등록되어있을 수 있다. 버그리포트를 검색해보는 것을 추천한다.
* 문제 회피하기: 문제를 발생시키는 부분을 제거, 쿼리 수정을 진행하고 제대로 작동하는 조그만 쿼리들로 쿼리를 분할한다.

# 6.9 특별한 테스트 도구

* mysqlslap: 비슷한 쿼리를 동시에 실행하는 부하를 쉽게 테스트할 수 있다. 새로 만든 빈 스키마에서 사용한다.
* sysbench: 전체적인 시스템의 성능 측정이 가능하다. 
* gypsy: 락 문제나 동시성 문제를 찾아내는데 도움이 된다.

# 6.10 유지보수 도구

* Percona 툴킷: 서버와 테이블을 제어할 수 있는 도구들이 있다.
* Mysql WB 유틸리티: 명령행에서 실행된다. 데이터가 아닌 데이터베이스 구조를 대상으로 주로 작업하며 이중화 설정, 데이터 이전과 같은 작업을 자동화 하는 데 도움이 된다.

# 7 좋은 습관

* 백업
	* 백업을 계획할 때는 언제든 완전복구를 어떻게 할지부터 고민해야 한다.
	* 보조서버는 백업 방법이 아니다. 
	* 주 단위 완전백업과 일 단위 증분 백업을 함꼐 사용하며, 모든 이진 로그를 보관하는 방법을 선호한다.
* 백업의 종류
	* 포맷에 의한 분류
		* 논리적 백업
		* 물리적 백업
	* Mysql 서버와 상호작용에 의한 분류
		* 온라인 백업
		* 오프라인 백업
	* Mysql 서버 객체와의 상호작용에 따른 분류
		* 콜드백업
		* 웜백업
		* 핫백업
	* 내용에 따른 분류
		* 완전백업
		* 증분백업
		* 부분백업
* 문제를 해결하는 가장 좋은 방법 -> 예방 그 예방은 권한관리, 환경설정 등으로 대비할 수 있다.
* 문제가 발생하면 그 문제에 가장 잘 맞는다고 생각되는 문제 해결 기법을 선택하기 전에 철저히 생각하는 것이 더 중요하다.
